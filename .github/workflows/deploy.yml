# GitHub Actions CI/CD 部署流程
# 原因：推送到 main 時自動在 Mac mini 上部署
# 測試 CICD v5

name: Deploy to Mac mini

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: {}

concurrency:
  group: deploy-accountbook
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: [self-hosted, macOS, X64]

    steps:
      - name: Show runner info
        run: |
          whoami
          uname -a
          docker version
          docker compose version

      - name: Unlock Keychain
        run: |
          security unlock-keychain -p "${{ secrets.MAC_PASSWORD }}" ~/Library/Keychains/login.keychain-db

      - name: Deploy AccountBook
        run: |
          /Users/steven/Documents/GitHub/1_AccountBook/build.sh